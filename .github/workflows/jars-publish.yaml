name: Build kotlin artifacts and publish to github packages

on:
  push:
    branches: [master, main, dev]

  pull_request:
    branches: [master, main, dev]

jobs:
  publish-cactus-cmd-api-server:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-cmd-api-server/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-cmd-api-server-${{ env.GITVERSION }}.jar
        path: packages/cactus-cmd-api-server/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-core-api:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-core-api/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-core-api-${{ env.GITVERSION }}.jar
        path: packages/cactus-core-api/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-consortium-manual:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-consortium-manual/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-consortium-manual-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-consortium-manual/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-keychain-google-sm:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-keychain-google-sm/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-keychain-google-sm-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-keychain-google-sm/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-keychain-aws-sm:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-keychain-aws-sm/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-keychain-aws-sm-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-keychain-aws-sm/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-keychain-azure-kv:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-keychain-azure-kv/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-keychain-azure-kv-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-keychain-azure-kv/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-ledger-connector-iroha:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-ledger-connector-iroha/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-ledger-connector-iroha-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-ledger-connector-iroha/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-keychain-memory:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-keychain-memory/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-keychain-memory-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-keychain-memory/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-ledger-connector-xdai:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-ledger-connector-xdai/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-ledger-connector-xdai-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-ledger-connector-xdai/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-keychain-vault:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-keychain-vault/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-keychain-vault-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-keychain-vault/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-ledger-connector-quorum:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-ledger-connector-quorum/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-ledger-connector-quorum-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-ledger-connector-quorum/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-htlc-eth-besu-erc20:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-htlc-eth-besu-erc20/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-htlc-eth-besu-erc20-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-htlc-eth-besu-erc20/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-ledger-connector-fabric:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-ledger-connector-fabric/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-ledger-connector-fabric-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-ledger-connector-fabric/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-keychain-memory-wasm:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-keychain-memory-wasm/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-keychain-memory-wasm-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-keychain-memory-wasm/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-ledger-connector-besu:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-ledger-connector-besu/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-ledger-connector-besu-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-ledger-connector-besu/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-odap-hermes:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-odap-hermes/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-odap-hermes-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-odap-hermes/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar

  publish-cactus-plugin-htlc-eth-besu:
    runs-on: ubuntu-20.04
    steps:
    - name: Install Indy SDK
      run: >
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
          && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
          && sudo apt-get update \
          && sudo apt-get install -y \
              libindy \
              libnullpay \
              libvcx \
              indy-cli \
          && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get the latest release version
      run: |
        export GITVERSION=$(git describe --tags | awk -F'.' '{print $$1}')
        echo "GITVERSION=$GITVERSION" >> $GITHUB_ENV

    - uses: actions/setup-java@v2
      with:
        distribution: 'adopt'
        java-version: '8'

    - name: Set up NodeJS v16.9.1
      uses: actions/setup-node@v2.1.2
      with:
        node-version: v16.9.1

    - run: yarn configure

    - name: Build the package
      run: |
        WDIR=`pwd`
        cd ${WDIR}/packages/cactus-plugin-htlc-eth-besu/src/main/kotlin/generated/openapi/kotlin-client
        chmod +x gradlew
        ./gradlew clean
        ./gradlew build

    - name: Upload the generated kotlin artifact to github packages
      uses: actions/upload-artifact@v3.0.0
      with:
        name: cactus-plugin-htlc-eth-besu-${{ env.GITVERSION }}.jar
        path: packages/cactus-plugin-htlc-eth-besu/src/main/kotlin/generated/openapi/kotlin-client/build/libs/kotlin-client-1.0.0.jar