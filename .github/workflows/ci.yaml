
name: Cactus_CI
'on':
  pull_request:
    branches:
      - main
      - dev
      - petermetz/**
  push:
    branches:
      - main
      - dev
jobs:
  optimize-ci:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v3.1.0
        with:
          fetch-depth: 0
      
      - name: Install Indy SDK
        run: >
          sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88 \
            && sudo add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic stable" \
            && sudo apt-get update \
            && sudo apt-get install -y \
                libindy \
                libnullpay \
                libvcx \
                indy-cli \
            && sudo rm -f /etc/apt/sources.list.d/sovrin.list*

      - name: Set up NodeJS v16.9.1
        uses: actions/setup-node@v2.1.2
        with:
          node-version: v16.9.1
      
      - run: yarn configure

      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v35
        with:
          separator: ","

      - name: List all changed files
        run: echo "${{ steps.changed-files.outputs.all_changed_files }}"

      
      - name: Run optimized cli script
        id: optimize-ci
        run: |
          OPTIMIZED_CI_OUTPUT=$(node tools/optimize-ci.js ${{ steps.changed-files.outputs.all_changed_files }})
          echo "OPTIMIZED_CI_OUTPUT=$OPTIMIZED_CI_OUTPUT" >> $GITHUB_OUTPUT
      
      - name: List the changed-files
        run: echo "The output is ${{ steps.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT }}"
    outputs:
      OPTIMIZED_CI_OUTPUT: ${{ steps.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT }}

  build-dev:
    continue-on-error: false
    env:
      DEV_BUILD_DISABLED: false
      FULL_BUILD_DISABLED: true
      JEST_TEST_RUNNER_DISABLED: true
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - run: ./tools/ci.sh
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Initialize Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-

  cactus-api-client:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-api-client')
    continue-on-error: false
    env:
      DEV_BUILD_DISABLED: false
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-api-client/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: ./packages/cactus-api-client/src/test/typescript/integration/default-consortium-provider.test.ts
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-cmd-api-server:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-cmd-api-server')
    continue-on-error: false
    env:
      DEV_BUILD_DISABLED: false
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-cmd-api-server/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: >-
        --files={./packages/cactus-cmd-api-server/src/test/typescript/benchmark/artillery-api-benchmark.test.ts,./packages/cactus-cmd-api-server/src/test/typescript/integration/jwt-socketio-endpoint-authorization.test.ts,./packages/cactus-cmd-api-server/src/test/typescript/integration/plugin-import-from-github.test.ts,./packages/cactus-cmd-api-server/src/test/typescript/integration/plugin-import-without-install.test.ts,./packages/cactus-cmd-api-server/src/test/typescript/integration/remote-plugin-imports.test.ts,./packages/cactus-cmd-api-server/src/test/typescript/unit/config/self-signed-certificate-generator/certificates-work-for-mutual-tls.test.ts,./packages/cactus-cmd-api-server/src/test/typescript/unit/config/self-signed-certificate-generator/generates-working-certificates.test.ts,./packages/cactus-cmd-api-server/src/test/typescript/unit/grpc-js-proto-loader-client-healthcheck.test.ts,./packages/cactus-cmd-api-server/src/test/typescript/unit/grpc-proto-gen-ts-client-healthcheck.test.ts,./packages/cactus-cmd-api-server/src/test/typescript/unit/grpc-proto-gen-ts-client-m-tls-enabled.test.ts,./packages/cactus-cmd-api-server/src/test/typescript/unit/plugins/install-basic-plugin-consortium-manual.test.ts,./packages/cactus-cmd-api-server/src/test/typescript/unit/plugins/install-basic-plugin-keychain-memory.test.ts,./packages/cactus-cmd-api-server/src/test/typescript/unit/plugins/install-basic-plugin-ledger-connector-fabric-0-7-0.test.ts,./packages/cactus-cmd-api-server/src/test/typescript/unit/plugins/install-basic-plugin-ledger-connector-quorum-0-7-0.test.ts}
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-cmd-socketio-server:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-cmd-socketio-server')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-cmd-socketio-server/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-common:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-common')
    continue-on-error: false
    env:
      DEV_BUILD_DISABLED: false
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-common/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: '--files={./packages/cactus-common/src/test/typescript/unit/key-converter.test.ts,./packages/cactus-common/src/test/typescript/unit/logging/logger.test.ts}'
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-core:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-core')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-core/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-core-api:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-core-api')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-core-api/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-example-carbon-accounting-backend:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-example-carbon-accounting-backend')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: examples/cactus-example-carbon-accounting-backend/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: ./examples/cactus-example-carbon-accounting-backend/src/test/typescript/integration/admin-enroll-v1-endpoint.test.ts
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-example-carbon-accounting-business-logic-plugin:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-example-carbon-accounting-business-logic-plugin')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: examples/cactus-example-carbon-accounting-business-logic-plugin/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-example-carbon-accounting-frontend:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-example-carbon-accounting-frontend')
    continue-on-error: false
    env:
      DEV_BUILD_DISABLED: false
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: examples/cactus-example-carbon-accounting-frontend/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: true
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-example-supply-chain-backend:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-example-supply-chain-backend')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: examples/cactus-example-supply-chain-backend/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: '--files={./examples/cactus-example-supply-chain-backend/src/test/typescript/integration/supply-chain-backend-api-calls.test.ts,./examples/cactus-example-supply-chain-backend/src/test/typescript/integration/supply-chain-cli-via-npm-script.test.ts}'
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-example-supply-chain-business-logic-plugin:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-example-supply-chain-business-logic-plugin')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: examples/cactus-example-supply-chain-business-logic-plugin/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-example-supply-chain-frontend:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-example-supply-chain-frontend')
    continue-on-error: false
    env:
      DEV_BUILD_DISABLED: false
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: examples/cactus-example-supply-chain-frontend/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: true
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-consortium-manual:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-consortium-manual')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-consortium-manual/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-htlc-coordinator-besu:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-htlc-coordinator-besu')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: extensions/cactus-plugin-htlc-coordinator-besu/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: >-
        --files={./extensions/cactus-plugin-htlc-coordinator-besu/src/test/typescript/integration/plugin-htlc-coordinator/counterparty-htlc-endpoint.test.ts,./extensions/cactus-plugin-htlc-coordinator-besu/src/test/typescript/integration/plugin-htlc-coordinator/own-htlc-endpoint.test.ts,./extensions/cactus-plugin-htlc-coordinator-besu/src/test/typescript/integration/plugin-htlc-coordinator/refund.test.ts,./extensions/cactus-plugin-htlc-coordinator-besu/src/test/typescript/integration/plugin-htlc-coordinator/withdraw-counterparty-endpoint.test.ts}
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-htlc-eth-besu:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-htlc-eth-besu')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-htlc-eth-besu/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-htlc-eth-besu-erc20:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-htlc-eth-besu-erc20')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-htlc-eth-besu-erc20/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-keychain-aws-sm:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-keychain-aws-sm')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-keychain-aws-sm/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: true
      TAPE_TEST_PATTERN: '--files={./packages/cactus-plugin-keychain-aws-sm/src/test/typescript/integration/openapi/openapi-validation.test.ts,./packages/cactus-plugin-keychain-aws-sm/src/test/typescript/integration/plugin-factory-keychain.test.ts,./packages/cactus-plugin-keychain-aws-sm/src/test/typescript/integration/plugin-factory-keychain.test.ts,./packages/cactus-plugin-keychain-aws-sm/src/test/typescript/integration/plugin-keychain-aws-sm.test.ts}'
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-keychain-azure-kv:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-keychain-azure-kv')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-keychain-azure-kv/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: ./packages/cactus-plugin-keychain-azure-kv/src/test/typescript/integration/plugin-keychain-azure-kv.test.ts
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-keychain-google-sm:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-keychain-google-sm')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-keychain-google-sm/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: '--files={./packages/cactus-plugin-keychain-google-sm/src/test/typescript/integration/openapi/openapi-validation.test.ts,./packages/cactus-plugin-keychain-google-sm/src/test/typescript/integration/plugin-factory-keychain.test.ts,./packages/cactus-plugin-keychain-google-sm/src/test/typescript/integration/plugin-keychain-google-sm.test.ts}'
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-keychain-memory:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-keychain-memory')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-keychain-memory/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-keychain-memory-wasm:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-keychain-memory-wasm')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-keychain-memory-wasm/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: ./packages/cactus-plugin-keychain-memory-wasm/src/test/typescript/unit/plugin-keychain-memory-wasm.test.ts
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-keychain-vault:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-keychain-vault')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-keychain-vault/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: '--files={./packages/cactus-plugin-keychain-vault/src/test/typescript/integration/cactus-keychain-vault-server.test.ts,./packages/cactus-plugin-keychain-vault/src/test/typescript/integration/openapi/openapi-validation.test.ts,./packages/cactus-plugin-keychain-vault/src/test/typescript/integration/plugin-keychain-vault.test.ts}'
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-ledger-connector-besu:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-ledger-connector-besu')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-ledger-connector-besu/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: >-
        --files={./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/deploy-contract/deploy-contract-from-json.test.ts,./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/deploy-contract/get-block.test.ts,./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/deploy-contract/get-past-logs.test.ts,./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/deploy-contract/get-record-locator.test.ts,./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/deploy-contract/private-deploy-contract-from-json-cactus.test.ts,./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/deploy-contract/private-deploy-contract-from-json-web3-eea.test.ts,./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/deploy-contract/v21-deploy-contract-from-json.test.ts,./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/deploy-contract/v21-get-balance.test.ts,./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/deploy-contract/v21-get-block.test.ts,./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/deploy-contract/v21-get-past-logs.test.ts,./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/deploy-contract/v21-get-record-locator.test.ts,./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/deploy-contract/v21-invoke-contract.test.ts,./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/lock-contract.test.ts,./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/openapi/openapi-validation.test.ts,./packages/cactus-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-ledger-connector-besu/v21-besu-get-transaction.test.ts}
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-ledger-connector-corda:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-ledger-connector-corda')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-ledger-connector-corda/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: >-
        --files={./packages/cactus-plugin-ledger-connector-corda/src/test/typescript/integration/deploy-cordapp-jars-to-nodes-v4.7.test.ts,./packages/cactus-plugin-ledger-connector-corda/src/test/typescript/integration/deploy-cordapp-jars-to-nodes-v4.8-express.test.ts,./packages/cactus-plugin-ledger-connector-corda/src/test/typescript/integration/deploy-cordapp-jars-to-nodes-v4.8.test.ts,./packages/cactus-plugin-ledger-connector-corda/src/test/typescript/integration/deploy-cordapp-jars-to-nodes.test.ts,./packages/cactus-plugin-ledger-connector-corda/src/test/typescript/integration/flow-database-access-v4.8.test.ts,./packages/cactus-plugin-ledger-connector-corda/src/test/typescript/integration/jvm-kotlin-spring-server-v4.7.test.ts,./packages/cactus-plugin-ledger-connector-corda/src/test/typescript/integration/jvm-kotlin-spring-server-v4.8.test.ts,./packages/cactus-plugin-ledger-connector-corda/src/test/typescript/integration/openapi/openapi-validation.test.ts}
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-ledger-connector-fabric:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-ledger-connector-fabric')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: >-
        --files={./packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/integration/fabric-v1-4-x/deploy-cc-from-golang-source.test.ts,./packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/integration/fabric-v1-4-x/run-transaction-endpoint-v1.test.ts,./packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/integration/fabric-v2-2-x/add-orgs.test.ts,./packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/integration/fabric-v2-2-x/deploy-cc-from-golang-source.test.ts,./packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/integration/fabric-v2-2-x/deploy-cc-from-javascript-source.test.ts,./packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/integration/fabric-v2-2-x/deploy-cc-from-typescript-source.test.ts,./packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/integration/fabric-v2-2-x/deploy-lock-asset.test.ts,./packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/integration/fabric-v2-2-x/obtain-profiles.test.ts,./packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/integration/fabric-v2-2-x/run-transaction-with-identities.test.ts,./packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/integration/fabric-v2-2-x/run-transaction-with-ws-ids.test.ts,./packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/integration/identity-client.test.ts,./packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/integration/openapi/openapi-validation-go.test.ts,./packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/integration/openapi/openapi-validation.test.ts,./packages/cactus-plugin-ledger-connector-fabric/src/test/typescript/unit/identity-internal-crypto-utils.test.ts}
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-ledger-connector-fabric-socketio:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-ledger-connector-fabric-socketio')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-ledger-connector-fabric-socketio/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-ledger-connector-go-ethereum-socketio:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-ledger-connector-go-ethereum-socketio')
    continue-on-error: false
    env:
      DEV_BUILD_DISABLED: false
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-ledger-connector-go-ethereum-socketio/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: true
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-ledger-connector-iroha:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-ledger-connector-iroha')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-ledger-connector-iroha/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: >-
        --files={./packages/cactus-plugin-ledger-connector-iroha/src/test/typescript/integration/iroha-iroha-transfer-example.test.ts,./packages/cactus-plugin-ledger-connector-iroha/src/test/typescript/integration/openapi/openapi-validation.test.ts,./packages/cactus-plugin-ledger-connector-iroha/src/test/typescript/integration/run-transaction-endpoint-v1.test.ts,./packages/cactus-plugin-ledger-connector-iroha/src/test/typescript/unit/iroha-test-ledger-parameters.test.ts,./packages/cactus-plugin-ledger-connector-iroha/src/test/typescript/unit/postgres-test-container-parameters.test.ts}
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-ledger-connector-iroha2:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-ledger-connector-iroha2')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-ledger-connector-iroha2/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.1.0
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-ledger-connector-quorum:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-ledger-connector-quorum')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-ledger-connector-quorum/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: >-
        --files={./packages/cactus-plugin-ledger-connector-quorum/src/test/typescript/integration/plugin-ledger-connector-quorum/deploy-contract/openapi/openapi-validation-no-keychain.test.ts,./packages/cactus-plugin-ledger-connector-quorum/src/test/typescript/integration/plugin-ledger-connector-quorum/deploy-contract/openapi/openapi-validation.test.ts,./packages/cactus-plugin-ledger-connector-quorum/src/test/typescript/integration/plugin-ledger-connector-quorum/deploy-contract/v2.3.0-deploy-contract-from-json-json-object-endpoints.test.ts,./packages/cactus-plugin-ledger-connector-quorum/src/test/typescript/integration/plugin-ledger-connector-quorum/deploy-contract/v2.3.0-deploy-contract-from-json-json-object.test.ts,./packages/cactus-plugin-ledger-connector-quorum/src/test/typescript/integration/plugin-ledger-connector-quorum/deploy-contract/v2.3.0-invoke-contract-json-object-endpoints.test.ts,./packages/cactus-plugin-ledger-connector-quorum/src/test/typescript/integration/plugin-ledger-connector-quorum/deploy-contract/v2.3.0-invoke-contract-json-object.test.ts,./packages/cactus-plugin-ledger-connector-quorum/src/test/typescript/integration/plugin-ledger-connector-quorum/deploy-contract/v21.4.1-deploy-contract-from-json-json-object-endpoints.test.ts,./packages/cactus-plugin-ledger-connector-quorum/src/test/typescript/integration/plugin-ledger-connector-quorum/deploy-contract/v21.4.1-deploy-contract-from-json-json-object.test.ts,./packages/cactus-plugin-ledger-connector-quorum/src/test/typescript/integration/plugin-ledger-connector-quorum/deploy-contract/v21.4.1-invoke-contract-json-object-endpoints.test.ts,./packages/cactus-plugin-ledger-connector-quorum/src/test/typescript/integration/plugin-ledger-connector-quorum/deploy-contract/v21.4.1-invoke-contract-json-object.test.ts}
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-ledger-connector-sawtooth-socketio:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-ledger-connector-sawtooth-socketio')
    continue-on-error: false
    env:
      DEV_BUILD_DISABLED: false
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-ledger-connector-sawtooth-socketio/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: true
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-ledger-connector-xdai:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-ledger-connector-xdai')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-ledger-connector-xdai/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: >-
        --files={./packages/cactus-plugin-ledger-connector-xdai/src/test/typescript/integration/deploy-contract-from-json-xdai-json-object.test.ts,./packages/cactus-plugin-ledger-connector-xdai/src/test/typescript/integration/invoke-contract-xdai-json-object.test.ts,./packages/cactus-plugin-ledger-connector-xdai/src/test/typescript/integration/openapi/openapi-validation-no-keychain.test.ts,./packages/cactus-plugin-ledger-connector-xdai/src/test/typescript/integration/openapi/openapi-validation.test.ts}
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-persistence-ethereum:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-persistence-ethereum')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-persistence-ethereum/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.1.0
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-object-store-ipfs:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-object-store-ipfs')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: extensions/cactus-plugin-object-store-ipfs/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: '--files={./extensions/cactus-plugin-object-store-ipfs/src/test/typescript/integration/plugin-object-store-ipfs.test.ts,./extensions/cactus-plugin-object-store-ipfs/src/test/typescript/unit/plugin-object-store-ipfs.test.ts}'
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-odap-hermes:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-odap-hermes')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-odap-hermes/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-plugin-connector-ubiquity:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-plugin-connector-ubiquity')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-plugin-ledger-connector-ubiquity/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
      UBIQUITY_AUTH_TOKEN: ${{ secrets.UBIQUITY_AUTH_TOKEN }}
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.1.0
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh
        env:
         UBIQUITY_AUTH_TOKEN: ${{ secrets.UBIQUITY_AUTH_TOKEN }}

  cactus-test-api-client:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-test-api-client')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-test-api-client/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-test-cmd-api-server:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-test-cmd-api-server')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-test-cmd-api-server/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: ./packages/cactus-test-cmd-api-server/src/test/typescript/integration/plugin-import-with-npm-install-version-selection.test.ts
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-test-plugin-consortium-manual:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-test-plugin-consortium-manual')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-test-plugin-consortium-manual/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: ./packages/cactus-test-plugin-consortium-manual/src/test/typescript/integration/plugin-consortium-manual/openapi/openapi-validation.test.ts
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-test-plugin-htlc-eth-besu:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-test-plugin-htlc-eth-besu')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-test-plugin-htlc-eth-besu/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: '--files={./packages/cactus-test-plugin-htlc-eth-besu/src/test/typescript/integration/plugin-htlc-eth-besu/get-single-status-endpoint.test.ts,./packages/cactus-test-plugin-htlc-eth-besu/src/test/typescript/integration/plugin-htlc-eth-besu/openapi/openapi-validation.test.ts}'
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-test-plugin-htlc-eth-besu-erc20:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-test-plugin-htlc-eth-besu-erc20')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-test-plugin-htlc-eth-besu-erc20/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: >-
        --files={./packages/cactus-test-plugin-htlc-eth-besu-erc20/src/test/typescript/integration/plugin-htlc-eth-besu-erc20/get-status-endpoint.test.ts,./packages/cactus-test-plugin-htlc-eth-besu-erc20/src/test/typescript/integration/plugin-htlc-eth-besu-erc20/openapi/openapi-validation.test.ts,./packages/cactus-test-plugin-htlc-eth-besu-erc20/src/test/typescript/integration/plugin-htlc-eth-besu-erc20/refund-endpoint.test.ts}
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-test-plugin-ledger-connector-besu:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-test-plugin-ledger-connector-besu')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-test-plugin-ledger-connector-besu/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: >-
        --files={./packages/cactus-test-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-validator-besu/get-balance-endpoint.test.ts,./packages/cactus-test-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-validator-besu/get-block-endpoint.test.ts,./packages/cactus-test-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-validator-besu/get-past-logs-endpoint.test.ts,./packages/cactus-test-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-validator-besu/get-transaction-endpoint.test.ts,./packages/cactus-test-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-validator-besu/v21-get-balance-endpoint.test.ts,./packages/cactus-test-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-validator-besu/v21-get-block-endpoint.test.ts,./packages/cactus-test-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-validator-besu/v21-get-past-logs-endpoint.test.ts,./packages/cactus-test-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-validator-besu/v21-get-transaction-endpoint.test.ts,./packages/cactus-test-plugin-ledger-connector-besu/src/test/typescript/integration/plugin-validator-besu/v21-sign-transaction-endpoint.test.ts}
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-test-plugin-ledger-connector-quorum:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-test-plugin-ledger-connector-quorum')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-test-plugin-ledger-connector-quorum/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-test-tooling:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-test-tooling')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-test-tooling/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_PATTERN: >-
        --files={./packages/cactus-test-tooling/src/test/typescript/integration/besu/besu-test-ledger/constructor-validates-options.test.ts,./packages/cactus-test-tooling/src/test/typescript/integration/fabric/fabric-test-ledger-v1/constructor-validates-options.test.ts,./packages/cactus-test-tooling/src/test/typescript/integration/iroha/iroha-test-ledger/constructor-validates-options.test.ts,./packages/cactus-test-tooling/src/test/typescript/integration/postgres/postgres-test-container/constructor-validates-options.test.ts,./packages/cactus-test-tooling/src/test/typescript/integration/quorum/quorum-test-ledger/constructor-validates-options.test.ts,./packages/cactus-test-tooling/src/test/typescript/integration/rustc-container/rustc-container-target-bundler.test.ts,./packages/cactus-test-tooling/src/test/typescript/integration/substrate/substrate-test-ledger-constructor.test.ts,./packages/cactus-test-tooling/src/test/typescript/integration/substrate/substrate-test-ledger-multiple-concurrent.test.ts}
      TAPE_TEST_RUNNER_DISABLED: false
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  cactus-verifier-client:
    needs: [optimize-ci, build-dev]
    if: contains(needs.optimize-ci.outputs.OPTIMIZED_CI_OUTPUT, 'cactus-verifier-client')
    continue-on-error: false
    env:
      FULL_BUILD_DISABLED: true
      JEST_TEST_PATTERN: packages/cactus-verifier-client/src/test/typescript/(unit|integration|benchmark)/.*/*.test.ts
      JEST_TEST_RUNNER_DISABLED: false
      TAPE_TEST_RUNNER_DISABLED: true
    runs-on: ubuntu-20.04
    steps:
      - name: Use Node.js v16.14.2
        uses: actions/setup-node@v3.6.0
        with:
          node-version: v16.14.2
      - uses: actions/checkout@v3.5.2
      - id: yarn-cache-dir-path
        name: Get yarn cache directory path
        run: echo "::set-output name=dir::$(yarn cache dir)"
      - id: yarn-cache
        name: Restore Yarn Cache
        uses: actions/cache@v3.0.4
        with:
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: ./tools/ci.sh

  get-diff:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v3.1.0

      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v35  
        with:
          separator: ","
    outputs:
      all-changed-files: ${{ steps.changed-files.outputs.all_changed_files }}

  ghcr-tools-besu-all-in-one:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'tools/docker/besu-all-in-one')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-besu-all-in-one
        run: DOCKER_BUILDKIT=1 docker build ./tools/docker/besu-all-in-one/ -f ./tools/docker/besu-all-in-one/Dockerfile
  ghcr-packages-cactus-cmd-api-server:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'packages/cactus-cmd-api-server')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-cmd-api-server
        run: DOCKER_BUILDKIT=1 docker build . -f ./packages/cactus-cmd-api-server/Dockerfile
  ghcr-packages-cactus-plugin-ledger-connector-besu:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'packages/cactus-plugin-ledger-connector-besu')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-connector-besu
        run: DOCKER_BUILDKIT=1 docker build ./packages/cactus-plugin-ledger-connector-besu/ -f ./packages/cactus-plugin-ledger-connector-besu/Dockerfile
  ghcr-packages-cactus-plugin-ledger-connector-corda-server:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'packages/cactus-plugin-ledger-connector-corda')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-connector-corda-server
        run: DOCKER_BUILDKIT=1 docker build ./packages/cactus-plugin-ledger-connector-corda/src/main-server/ -f ./packages/cactus-plugin-ledger-connector-corda/src/main-server/Dockerfile
  ghcr-packages-cactus-plugin-ledger-connector-fabric:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'packages/cactus-plugin-ledger-connector-fabric')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-connector-fabric
        run: DOCKER_BUILDKIT=1 docker build ./packages/cactus-plugin-ledger-connector-fabric/ -f ./packages/cactus-plugin-ledger-connector-fabric/Dockerfile
  ghcr-tools-corda-all-in-one:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'tools/docker/corda-all-in-one')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-corda-all-in-one
        run: DOCKER_BUILDKIT=1 docker build ./tools/docker/corda-all-in-one/ -f ./tools/docker/corda-all-in-one/Dockerfile
  ghcr-tools-corda-all-in-one-flowdb:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'tools/docker/corda-all-in-one')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-corda-all-in-one-flowdb
        run: DOCKER_BUILDKIT=1 docker build ./tools/docker/corda-all-in-one/corda-v4_8-flowdb/
  ghcr-tools-corda-all-in-one-obligation:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'tools/docker/corda-all-in-one')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-corda-all-in-one-obligation
        run: DOCKER_BUILDKIT=1 docker build ./tools/docker/corda-all-in-one/ -f ./tools/docker/corda-all-in-one/corda-v4_8/Dockerfile
  ghcr-dev-container-vscode:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, '.devcontainer')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-dev-container-vscode
        run: DOCKER_BUILDKIT=1 docker build ./.devcontainer/ -f ./.devcontainer/Dockerfile
  ghcr-examples-carbon-accounting:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'examples/carbon-accounting')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-example-carbon-accounting
        run: DOCKER_BUILDKIT=1 docker build . -f ./examples/carbon-accounting/Dockerfile
  ghcr-examples-supply-chain-app:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'examples/supply-chain-app')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-example-supply-chain-app
        run: DOCKER_BUILDKIT=1 docker build . -f ./examples/supply-chain-app/Dockerfile
  ghcr-tools-fabric-all-in-one:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'tools/docker/fabric-all-in-one')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-fabric-all-in-one
        run: DOCKER_BUILDKIT=1 docker build ./tools/docker/fabric-all-in-one/ -f ./tools/docker/fabric-all-in-one/Dockerfile_v1.4.x
  ghcr-tools-fabric2-all-in-one:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'tools/docker/fabric-all-in-one')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-fabric2-all-in-one
        run: DOCKER_BUILDKIT=1 docker build ./tools/docker/fabric-all-in-one/ -f ./tools/docker/fabric-all-in-one/Dockerfile_v2.x
  ghcr-tools-iroha-all-in-one:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'tools/docker/iroha-all-in-one')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-iroha-all-in-one
        run: DOCKER_BUILDKIT=1 docker build ./tools/docker/iroha-all-in-one/ -f ./tools/docker/iroha-all-in-one/Dockerfile
  ghcr-packages-cactus-plugin-keychain-vault-server:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'packages/cactus-plugin-keychain-vault/src/cactus-keychain-vault-server')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-keychain-vault-server
        run: DOCKER_BUILDKIT=1 docker build ./packages/cactus-plugin-keychain-vault/src/cactus-keychain-vault-server/ -f ./packages/cactus-plugin-keychain-vault/src/cactus-keychain-vault-server/Dockerfile
  ghcr-tools-quorum-all-in-one:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'tools/docker/quorum-all-in-one')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-quorum-all-in-one
        run: DOCKER_BUILDKIT=1 docker build ./tools/docker/quorum-all-in-one/ -f ./tools/docker/quorum-all-in-one/Dockerfile
  ghcr-tools-quorum-multi-party-all-in-one:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'tools/docker/quorum-multi-party-all-in-one')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-quorum-multi-party-all-in-one
        run: DOCKER_BUILDKIT=1 docker build ./tools/docker/quorum-multi-party-all-in-one/ -f ./tools/docker/quorum-multi-party-all-in-one/Dockerfile
  ghcr-tools-rust-compiler:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'tools/docker/rust-compiler')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-rust-compiler
        run: DOCKER_BUILDKIT=1 docker build ./tools/docker/rust-compiler/ -f ./tools/docker/rust-compiler/Dockerfile
  ghcr-tools-test-npm-registry:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'tools/docker/test-npm-registry')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-test-npm-registry
        run: DOCKER_BUILDKIT=1 docker build ./tools/docker/test-npm-registry/ -f ./tools/docker/test-npm-registry/Dockerfile
  ghcr-whitepaper:
    needs: get-diff
    runs-on: ubuntu-20.04
    if: contains(needs.get-diff.outputs.all-changed-files, 'whitepaper/')
    steps:
      - uses: actions/checkout@v3.5.2
      - name: ghcr.io/hyperledger/cactus-whitepaper
        run: DOCKER_BUILDKIT=1 docker build ./whitepaper/ -f ./whitepaper/Dockerfile
